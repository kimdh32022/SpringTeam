<!doctype html>
<html lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/base.html}">
<body>
<!-- content -->
<div layout:fragment="content">
    <div class="container mt-5">
        <h1>회원정보 수정</h1>
        <form th:action="@{/users/update}" method="post" id="update-form" enctype="multipart/form-data">
            <!-- Hidden input for userId -->
            <input type="hidden" th:name="userId" th:value="${user.userId}" />

            <!-- Email field (readonly) -->
            <div class="form-group">
                <label for="email">이메일</label>
                <input type="email" id="email" name="email" th:value="${user.email}" class="form-control" required readonly>
            </div>
            <!-- Editable fields -->
            <div class="form-group">
                <label for="password">현재 비밀번호</label>
                <input type="text" id="nowpassword" name="nowpassword" th:value="${user.password}" class="form-control" required readonly>
            </div>

            <div class="form-group">
                <label for="password">변경할 비밀번호</label>
                <input type="password" id="password" name="password" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="confirm-password">비밀번호 확인</label>
                <input type="password" id="confirm-password" placeholder="비밀번호 확인" required class="form-control">
                <p id="password-message" class="text-danger"></p>
            </div>

            <div class="form-group">
                <label for="name">이름</label>
                <input type="text" id="name" name="name" th:value="${user.name}" class="form-control" required>
            </div>

            <div class="form-group">
                <label>성별</label>
                <div class="form-check">
                    <input type="radio" id="male" name="gender" value="male" th:checked="${user.gender == 'male'}" required class="form-check-input">
                    <label for="male" class="form-check-label">남</label>
                </div>
                <div class="form-check">
                    <input type="radio" id="female" name="gender" value="female" th:checked="${user.gender == 'female'}" class="form-check-input">
                    <label for="female" class="form-check-label">여</label>
                </div>
            </div>

            <div class="form-group">
                <label for="phoneNumber">전화번호</label>
                <input type="text" id="phoneNumber" name="phoneNumber" th:value="${user.phoneNumber}" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="birth">생년월일</label>
                <input type="date" id="birth" name="birth" th:value="${user.birth}" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="address">주소</label>
                <input type="text" id="address" name="address" th:value="${user.address}" class="form-control" required>
            </div>

            <div class="form-group">
                <label>현재 프로필 사진</label>
                <!-- 현재 프로필 사진 표시 -->
                <img th:src="${user.profilePicture != null ? user.profilePicture : 'https://via.placeholder.com/150'}"
                     alt="Profile Picture" width="150" height="150" class="img-thumbnail">
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-3">수정 완료</button>
        </form>
        <div class="text-center mt-4">
            <form th:action="@{/users/delete}" method="post" id="delete-form">
                <input type="hidden" th:name="userId" th:value="${user.userId}" />
                <button type="submit" class="btn btn-danger w-100">회원 탈퇴</button>
            </form>
        </div>
    </div>
</div>
<!-- content -->

<!-- javascript -->
<script layout:fragment="javascript" th:inline="javascript">

    document.getElementById('confirm-password').addEventListener('input', function() {
        const password = document.getElementById('password').value;
        const confirmPassword = this.value;
        const message = document.getElementById('password-message');
        message.innerText = (password !== confirmPassword) ? '비밀번호가 일치하지 않습니다.' : '';
    });
</script>
<!-- javascript -->

</body>
</html>
